import{j as r}from"./jsx-runtime.s_qdhQ62.js";import{c as D,g as L,r as p}from"./index.DRjF_FHU.js";import T from"./BlurFadeIn.B6ut5pWM.js";import{d as P,a as j}from"./dayjs.min.nudpyx_h.js";import{m as R}from"./medium-zoom.esm.bWEtUbjf.js";import"./proxy.BCfPt3pk.js";async function A(t){const u=new URL("moments","https://api.luckycc.cc/"),d=new URLSearchParams;t.page&&d.set("page",t.page.toString()),t.limit&&d.set("limit",t.limit.toString()),t.visibility&&d.set("visibility",t.visibility),u.search=d.toString();const o=await(await fetch(u,{method:"GET"})).json();return o.data?.items&&(o.data.items=o.data.items.map(i=>({...i,createdAt:new Date(i.createdAt),updatedAt:new Date(i.updatedAt)}))),o}async function $(t={}){return A(t)}var H={exports:{}};(function(t,u){(function(d,m){t.exports=m()})(D,function(){return function(d,m,o){d=d||{};var i=m.prototype,l={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function c(e,f,g,x){return i.fromToBase(e,f,g,x)}o.en.relativeTime=l,i.fromToBase=function(e,f,g,x,a){for(var n,h,y,M=g.$locale().relativeTime||l,Y=d.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],S=Y.length,w=0;w<S;w+=1){var v=Y[w];v.d&&(n=x?o(e).diff(g,v.d,!0):g.diff(e,v.d,!0));var _=(d.rounding||Math.round)(Math.abs(n));if(y=n>0,_<=v.r||!v.r){_<=1&&w>0&&(v=Y[w-1]);var b=M[v.l];a&&(_=a(""+_)),h=typeof b=="string"?b.replace("%d",_):b(_,f,v.l,y);break}}if(f)return h;var N=y?M.future:M.past;return typeof N=="function"?N(h):N.replace("%s",h)},i.to=function(e,f){return c(e,f,this,!0)},i.from=function(e,f){return c(e,f,this)};var s=function(e){return e.$u?o.utc():o()};i.toNow=function(e){return this.to(s(this),e)},i.fromNow=function(e){return this.from(s(this),e)}}})})(H);var z=H.exports;const I=L(z);var W={exports:{}};(function(t,u){(function(d,m){t.exports=m(P)})(D,function(d){function m(l){return l&&typeof l=="object"&&"default"in l?l:{default:l}}var o=m(d),i={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(l,c){return c==="W"?l+"周":l+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(l,c){var s=100*l+c;return s<600?"凌晨":s<900?"早上":s<1100?"上午":s<1300?"中午":s<1800?"下午":"晚上"}};return o.default.locale(i,null,!0),i})})(W);function k({images:t}){const u=p.useRef(null);if(p.useEffect(()=>{if(!u.current)return;const o=u.current.querySelectorAll("img"),i=R(o,{margin:24,background:"rgba(0, 0, 0, 0.9)",scrollOffset:0});if(/iPad|iPhone|iPod/.test(navigator.userAgent)){let c={},s=null;i.on("open",()=>{const e=i.getZoomedImage();if(e){s=e,c={width:e.style.width,height:e.style.height,maxWidth:e.style.maxWidth,maxHeight:e.style.maxHeight,left:e.style.left,top:e.style.top,transform:e.style.transform,zoom:e.style.zoom},e.style.setProperty("zoom","1","important");const f=e.naturalWidth,g=e.naturalHeight,x=f/g,a=window.innerWidth-48,n=window.innerHeight-48;let h,y;f/a>g/n?(h=a,y=a/x):(y=n,h=n*x),requestAnimationFrame(()=>{e.style.setProperty("width",`${h}px`,"important"),e.style.setProperty("height",`${y}px`,"important"),e.style.setProperty("max-width","none","important"),e.style.setProperty("max-height","none","important"),e.style.setProperty("left",`${(window.innerWidth-h)/2}px`,"important"),e.style.setProperty("top",`${(window.innerHeight-y)/2}px`,"important"),e.style.setProperty("transform","none","important")})}}),i.on("closed",()=>{s&&(s.style.width=c.width||"",s.style.height=c.height||"",s.style.maxWidth=c.maxWidth||"",s.style.maxHeight=c.maxHeight||"",s.style.left=c.left||"",s.style.top=c.top||"",s.style.transform=c.transform||"",s.style.zoom=c.zoom||"",s=null)})}return()=>{i.detach()}},[t]),t.length===0)return null;const d=()=>t.length===1?"grid-cols-1":t.length===2||t.length===4?"grid-cols-2":"grid-cols-3",m=t.length===1;return r.jsxs("div",{ref:u,className:`mt-4 grid gap-2 ${d()}`,children:[t.slice(0,9).map((o,i)=>r.jsx("div",{className:`overflow-hidden rounded-lg bg-gray-800 ${m?"max-w-md":"aspect-square"}`,style:m?{aspectRatio:`${o.width}/${o.height}`,maxHeight:"400px"}:void 0,children:r.jsx("img",{src:o.url,alt:`Image ${i+1}`,loading:"lazy",className:"h-full w-full cursor-zoom-in object-cover transition-transform duration-300 hover:scale-105"})},i)),t.length>9&&r.jsxs("div",{className:"flex aspect-square items-center justify-center rounded-lg bg-gray-800/50 text-gray-400",children:["+",t.length-9]})]})}j.extend(I);j.locale("zh-cn");function E({moment:t}){const u=j(t.createdAt).fromNow(),d=j(t.createdAt).format("YYYY-MM-DD HH:mm");return r.jsxs("div",{className:"moment-card group",children:[r.jsx("div",{className:"mb-2 flex items-center gap-2",children:r.jsx("span",{className:"text-sm text-gray-400",title:d,children:u})}),r.jsx("div",{className:"whitespace-pre-wrap text-base leading-relaxed text-gray-100",children:t.content}),t.images.length>0&&r.jsx(k,{images:t.images}),t.tags.length>0&&r.jsx("div",{className:"mt-4 flex flex-wrap gap-2",children:t.tags.map(m=>r.jsxs("span",{className:"rounded-full bg-gray-700/50 px-2 py-1 text-xs text-gray-300 transition-colors hover:bg-gray-600/50",children:["#",m]},m))})]})}function U({limit:t=10}){const[u,d]=p.useReducer((a,n)=>[...a,...n],[]),m=p.useRef(1),[o,i]=p.useState(!0),[l,c]=p.useState(!1),s=p.useRef(null),e=p.useMemo(()=>{const a={};return u.forEach(n=>{const h=j(n.createdAt).format("YYYY-MM-DD");a[h]||(a[h]=[]),a[h].push(n)}),a},[u]),f=async()=>{if(l||!o)return;c(!0);const a=m.current;try{const n=await $({page:a,limit:t,visibility:"public"});(n.data.items.length===0||!n.data.hasMore)&&i(!1),n.data.items.length>0&&(d(n.data.items),m.current+=1)}catch(n){console.error("Failed to load moments:",n),i(!1)}finally{c(!1)}};p.useEffect(()=>{const a=new IntersectionObserver(n=>{n[0].isIntersecting&&o&&!l&&f()},{threshold:.1});return s.current&&a.observe(s.current),()=>{s.current&&a.unobserve(s.current),a.disconnect()}},[o,l]);const g=Object.keys(e).sort((a,n)=>new Date(n).getTime()-new Date(a).getTime());let x=0;return r.jsxs("div",{className:"moments-timeline",children:[g.map(a=>r.jsxs("div",{className:"mb-8",children:[r.jsx("div",{className:"moment-date-marker relative mb-4",children:r.jsx("span",{className:"text-sm font-medium text-gray-400",children:j(a).format("MM月DD日")})}),r.jsx("div",{className:"flex flex-col gap-4",children:e[a].map(n=>{const h=x++;return r.jsx(T,{delay:.1*(h%5),children:r.jsx(E,{moment:n})},n.id)})})]},a)),r.jsx("div",{ref:s,className:"h-10"}),l&&r.jsxs("div",{className:"flex items-center justify-center gap-2 py-4",children:[r.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-gray-600 border-t-gray-400"}),r.jsx("span",{className:"text-xs text-gray-500",children:"加载中..."})]}),!o&&!l&&u.length>0&&r.jsx("div",{className:"flex items-center justify-center py-8",children:r.jsx("span",{className:"text-sm text-gray-500",children:"没有更多了 ~"})}),!l&&u.length===0&&r.jsx("div",{className:"flex items-center justify-center py-20",children:r.jsx("div",{className:"text-center",children:r.jsx("div",{className:"mb-2 text-lg text-gray-500",children:"他们消失了"})})})]})}export{U as default};
