---
const { friend } = Astro.props;
import defaultAvatar from '../../../public/defaultAvatar.png';

// 从URL中提取域名
function getDomainFromUrl(url: string) {
	try {
		const domain = new URL(url).hostname;
		return `https://${domain}/favicon.ico`;
	} catch {
		return defaultAvatar.src;
	}
}

// 获取头像URL
const avatarUrl =
	friend.avatar || (friend.link ? getDomainFromUrl(friend.link) : defaultAvatar.src);
---

<a
	href={friend.link}
	target="_blank"
	rel="noopener noreferrer"
	class="group relative block overflow-hidden rounded-xl bg-white/5 p-6 backdrop-blur-xl border border-white/10 transition-all duration-300 hover:-translate-y-0.5 hover:bg-white/8 hover:shadow-lg hover:shadow-black/20 min-h-[120px]"
>
	<div class="relative z-10 flex items-center gap-4">
		<div class="flex-shrink-0">
			<img
				src={avatarUrl}
				alt={`${friend.name}'s avatar`}
				class="h-[60px] w-[60px] rounded-full border-2 border-white/10 object-cover transition-all duration-300 group-hover:scale-105 group-hover:border-white/20 md:h-[50px] md:w-[50px]"
				onerror={`this.onerror=null; this.src='${defaultAvatar.src}'`}
			/>
		</div>
		<div class="flex-grow">
			<div class="mb-2 text-xl font-semibold text-white md:text-lg">{friend.name}</div>
			{
				friend.description && (
					<div class="text-sm text-white/70 md:text-sm">{friend.description}</div>
				)
			}
		</div>
	</div>
	<div
		class="pointer-events-none absolute inset-0 -left-full h-full w-2/3 bg-gradient-to-r from-transparent via-white/5 to-transparent transition-all duration-700 ease-out group-hover:left-full"
	>
	</div>
</a>
